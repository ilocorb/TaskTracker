{% extends 'base.html' %}

{% block content %}

<!-- Dashboard Section -->
<section id="dashboard-section">
    <!-- Greeting Section (Outside Card) -->
    <div class="greeting-section">
        <div class="greeting-content">
            <div class="greeting-line">
                <span id="greeting-time">Good Evening,</span>
                <strong id="user-display-name">Loading...</strong>
            </div>
            <div class="date-context">
                <span id="current-date">Tuesday, Jan 14</span>
                <span class="separator">â€¢</span>
                <span id="week-number">Week 3</span>
            </div>
        </div>
        <div class="greeting-actions">
            <button id="admin-btn" class="icon-btn" title="Admin Panel" style="display: none;">
                <i class="fas fa-user-shield"></i>
            </button>
            <button id="logout-btn" class="icon-btn" title="Logout">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </div>

    <!-- Header -->
    <header class="glass-header">

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Top Row -->
            <div class="dashboard-top-row">
                <!-- Left Card: Open Tasks -->
                <div class="side-card">
                    <div class="side-card-top">
                        <i class="fas fa-tasks"></i>
                        <span class="side-card-number" id="open-count">0</span>
                    </div>
                    <span class="side-card-label">Open Tasks</span>
                </div>

                <!-- Center: Circular Progress -->
                <div class="progress-circle-container">
                    <svg class="progress-circle" width="100" height="100">
                        <defs>
                            <linearGradient id="progress-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#2575fc;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#6a11cb;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <circle class="progress-circle-bg" cx="50" cy="50" r="44"></circle>
                        <circle class="progress-circle-fill" id="progress-circle" cx="50" cy="50" r="44"></circle>
                    </svg>
                    <div class="progress-circle-text">
                        <span class="progress-percentage" id="progress-text">0%</span>
                        <span class="progress-label">Overall</span>
                    </div>
                </div>

                <!-- Right Card: In Progress Tasks -->
                <div class="side-card">
                    <div class="side-card-top">
                        <i class="fas fa-spinner"></i>
                        <span class="side-card-number" id="in-progress-count">0</span>
                    </div>
                    <span class="side-card-label"> In Progress</span>
                </div>
            </div>

            <!-- Bottom Row: 3 Stat Cards with Bars -->
            <div class="dashboard-bottom-row">
                <div class="stat-card">
                    <div class="stat-card-header">
                        <i class="fas fa-calendar-day"></i>
                        <span class="stat-card-label">Due Today</span>
                    </div>
                    <div class="stat-card-bar-container">
                        <div class="stat-card-bar stat-bar-today" id="due-today-bar"></div>
                    </div>
                    <span class="stat-card-number" id="due-today-count">0</span>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <i class="fas fa-exclamation-circle"></i>
                        <span class="stat-card-label">Overdue</span>
                    </div>
                    <div class="stat-card-bar-container">
                        <div class="stat-card-bar stat-bar-overdue" id="overdue-bar"></div>
                    </div>
                    <span class="stat-card-number" id="overdue-count">0</span>
                </div>

                <div class="stat-card">
                    <div class="stat-card-header">
                        <i class="fas fa-check-circle"></i>
                        <span class="stat-card-label">Today</span>
                    </div>
                    <div class="stat-card-bar-container">
                        <div class="stat-card-bar stat-bar-completed" id="completed-today-bar"></div>
                    </div>
                    <span class="stat-card-number" id="completed-today-count">0</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Controls (Search & Filter) -->
    <div class="controls-area">
        <div class="search-bar">
            <i class="fas fa-search"></i>
            <input type="text" id="search-input" placeholder="Search tasks...">
        </div>

        <div class="filter-sort-row">
            <label for="filter-select" class="sr-only">Filter tasks</label>
            <select id="filter-select" class="glass-select" aria-label="Filter tasks">
                <option value="all">All Tasks</option>
                <option value="high_priority">High Priority</option>
                <option value="overdue">Overdue</option>
            </select>
            <label for="sort-select" class="sr-only">Sort tasks</label>
            <select id="sort-select" class="glass-select" aria-label="Sort tasks">
                <option value="created_at">Newest</option>
                <option value="due_date">Due Date</option>
                <option value="priority">Priority</option>
            </select>
        </div>
    </div>

    <!-- Mobile Status Filter Tabs (replaces column headers on mobile) -->
    <div class="mobile-filter-tabs">
        <button class="status-tab" data-status="todo">
            <div class="tab-label-row">
                <i class="fas fa-circle"></i>
                <span class="tab-label">To Do</span>
            </div>
            <span class="tab-count" id="tab-todo-count">0</span>
        </button>
        <button class="status-tab" data-status="in_progress">
            <div class="tab-label-row">
                <i class="fas fa-spinner"></i>
                <span class="tab-label">In Progress</span>
            </div>
            <span class="tab-count" id="tab-in-progress-count">0</span>
        </button>
        <button class="status-tab" data-status="done">
            <div class="tab-label-row">
                <i class="fas fa-check-circle"></i>
                <span class="tab-label">Done</span>
            </div>
            <span class="tab-count" id="tab-done-count">0</span>
        </button>
    </div>

    <!-- Task List - 3 Column Grid for Desktop, Single List for Mobile -->
    <div id="tasks-container" class="tasks-container">
        <!-- Desktop: 3-column grid -->
        <div class="tasks-grid">
            <!-- TO-DO Column -->
            <div class="task-column">
                <div class="column-header">
                    <i class="fas fa-circle"></i>
                    <h3>TO-DO</h3>
                    <span class="task-count" id="todo-count">0</span>
                </div>
                <div id="todo-tasks" class="tasks-list">
                    <!-- TO-DO tasks injected here -->
                </div>
            </div>

            <!-- In Progress Column -->
            <div class="task-column">
                <div class="column-header in-progress">
                    <i class="fas fa-spinner"></i>
                    <h3>In Progress</h3>
                    <span class="task-count" id="in-progress-count">0</span>
                </div>
                <div id="in-progress-tasks" class="tasks-list">
                    <!-- In Progress tasks injected here -->
                </div>
            </div>

            <!-- Done Column -->
            <div class="task-column">
                <div class="column-header done">
                    <i class="fas fa-check-circle"></i>
                    <h3>Done</h3>
                    <span class="task-count" id="done-count">0</span>
                </div>
                <div id="done-tasks" class="tasks-list">
                    <!-- Done tasks injected here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button id="add-task-btn" class="fab" title="Add Task">
        <i class="fas fa-plus"></i>
    </button>
</section>


<!-- Add/Edit Task Modal -->
<div id="task-modal" class="modal hidden">
    <div class="modal-content glass-panel">
        <div class="modal-header">
            <h2 id="modal-title">Add New Task</h2>
            <button id="close-modal" class="icon-btn"><i class="fas fa-times"></i></button>
        </div>
        <form id="task-form">
            <input type="hidden" id="task-id">
            <div class="form-group">
                <label>Title</label>
                <input type="text" id="task-title" class="glass-input"
                    placeholder="Conquer the world, one task at a time!" required>
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea id="task-desc" class="glass-input" rows="3"></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="task-priority">Priority</label>
                    <select id="task-priority" class="glass-select">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Due Date</label>
                    <input type="date" id="task-due" class="glass-input">
                </div>
            </div>
            <div class="form-group">
                <label>Tags (comma separated)</label>
                <input type="text" id="task-tags" class="glass-input" placeholder="e.g. work, school">
            </div>
            <div class="modal-actions">
                <button id="delete-task-btn" type="button" class="btn-delete-modal hidden">
                    <i class="fas fa-trash"></i>
                </button>
                <button id="submit-btn" type="submit" class="btn-primary">Add Task</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}